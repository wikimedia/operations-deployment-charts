# Use together with values-staging.yaml from ../../helmfile.d/services/rest-gateway/
# or ../../helmfile.d/services/api-gateway/
main_app:
  command: ~
  args: ["-l", "debug"]
  #version: "1.26.8-1"
  telemetry_port: 8089

  # Use fake backend
  http_https_echo: true

  # Use redis sidecar
  dev_redis: true
  redis_port: 6380 # nutcracker

  domains:
    - localhost
    - localhost:*
    - 127.0.0.1
    - 127.0.0.1:*
    - restgateway.discovery.wmnet
    - mytestdomain.discovery.wmnet

  discovery_endpoints:
    mobileapps:
      tls: false
      port: 8888
      internal_host: localhost
      host: localhost
    citoid:
      tls: false
      port: 8888
      internal_host: localhost
      host: localhost
    proton:
      tls: false
      port: 8888
      internal_host: localhost
      host: localhost

  jwt:
    enabled: true
    issuer: http://dev.wikipedia.org

  jwks:
    # Use OCT for testing, so we can easily generate tokens.
    # Production must use RSA.
    type: "OCT"
    kid: "testkey"
    # the key is "testsecret" stored as base64
    key: "dGVzdHNlY3JldA=="

nutcracker:
  enabled: true
  port: 6380 # use different port here because local redis uses 6379
  servers:
    - localhost:6379:1 "cp-1" # dev_redis sidecar

# Settings for the end-to-end tests defined under tests/e2e.
# Local overrides go into tests/e2e/values-tests.local.yaml.
smokepy:
  gateway:
    # The target URL to use for end-to-end tests.
    # Can also be set using $GATEWAY_TEST_TARGET_URL.
    target_url: http://localhost:8087

    # The path of the endpoint to probe when testing rate limits.
    probe_path: "/enwiki/v1/page/pdf/xyz"

    # The header to send with every request
    headers:
      Host: localhost

    # Override with a valid JWT in values-minikube.local.yaml
    #valid_jwt: a7ebadf00d
